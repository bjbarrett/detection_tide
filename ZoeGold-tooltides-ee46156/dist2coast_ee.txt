// Script author: K Tiedeman 
// Cleaned and commented for publication 20 Dec 2022
// Google Earth Engine

var geometry = 
    /* color: #d63000 */
    /* shown: false */
    /* displayProperties: [
      {
        "type": "rectangle"
      }
    ] */
    ee.Geometry.Polygon(
        [[[-81.8286833951577, 7.299347810255292],
          [-81.8286833951577, 7.2252741551288295],
          [-81.75383903480613, 7.2252741551288295],
          [-81.75383903480613, 7.299347810255292]]], null, false),
    geometry2 = 
    /* color: #98ff00 */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[-81.82179317641527, 7.289904752524635],
          [-81.82091341159952, 7.281135563189023],
          [-81.82524786259495, 7.274537273675048],
          [-81.82057008873475, 7.266576627562514],
          [-81.81512214830593, 7.25158142076541],
          [-81.80947866755862, 7.2397460818200186],
          [-81.80682868161094, 7.233658102380236],
          [-81.8052462146216, 7.230188369678039],
          [-81.80520870096781, 7.227144375063477],
          [-81.80263376846582, 7.226080044104365],
          [-81.80016615670512, 7.228464194937793],
          [-81.79714061397023, 7.230209721678946],
          [-81.79967267269363, 7.238245350644152],
          [-81.79877152502462, 7.242449367969287],
          [-81.795252556693, 7.247707019961717],
          [-81.78714152444846, 7.259265433879016],
          [-81.78645469021879, 7.261543181100776],
          [-81.7837081315109, 7.267056051204701],
          [-81.78437332289447, 7.269812485094541],
          [-81.78349356017006, 7.272398637459439],
          [-81.7832789730558, 7.274420739258232],
          [-81.78143359350716, 7.276272558979242],
          [-81.77594046410783, 7.280274129148198],
          [-81.76976061654534, 7.282189716327117],
          [-81.76767922164363, 7.284616154042202],
          [-81.76808155117527, 7.285275972374034],
          [-81.76856971252478, 7.285829367176247],
          [-81.76907933304736, 7.286744596238859],
          [-81.76896668244432, 7.287851383717274],
          [-81.76847315584176, 7.29055448539841],
          [-81.77023268545598, 7.2917889673561165],
          [-81.77551127430253, 7.292278502366846],
          [-81.7801461328041, 7.289809537755029],
          [-81.78426600705087, 7.287468265988381],
          [-81.78671217844312, 7.289023549332043],
          [-81.78761340465906, 7.290578826682152],
          [-81.78842879552639, 7.291217354211309],
          [-81.78984500336708, 7.291813308414017],
          [-81.79147578691344, 7.291217352065518],
          [-81.7949304731101, 7.289791310440397],
          [-81.79675437559509, 7.2905788265387095],
          [-81.79784871510734, 7.29141955476002],
          [-81.79980136605194, 7.291408909647748],
          [-81.80237628745913, 7.291834592622275],
          [-81.80475809488956, 7.290472411959857],
          [-81.80672147117455, 7.290014802475048],
          [-81.80877067557365, 7.289897731611832],
          [-81.81355573782068, 7.289748741959183],
          [-81.81628622205226, 7.28999883900461],
          [-81.81737251591686, 7.290475071947085],
          [-81.81833006637147, 7.291355702124706],
          [-81.81833543345054, 7.291925051330661],
          [-81.81814768096586, 7.292515684514483],
          [-81.81840517200996, 7.293026502655539],
          [-81.81883432519813, 7.293452184199426],
          [-81.81898453041886, 7.2944951021604725],
          [-81.819692633393, 7.294814363010031],
          [-81.8205509409307, 7.294665374236029]]]);

//image name redacted 
var image = ee.Image('users/xx');
print(image)

var addVariables = function(image) {
  //function cleaned to just ndvi
  var ndvi = image.normalizedDifference(['nir', 'red']).rename('NDVI').float();
 
  return image
      // Add the response variables last.
      .addBands([ndvi])
      // Retain this metadata property 
      .copyProperties(image, ['system:time_start']);
};

// Change band names
var meep = image.select(['b1','b2','b3','b4'], ['blue', 'green', 'red', 'nir']);
//add NDVI here
var meep = ee.Image(addVariables(meep));

//Print image and bandnames 
print(meep)
print(ee.Image(meep).bandNames())

//mask NDVI greater than 0.7 for vegetation 
var mask = meep.select('NDVI').gte(0.7) 
var image1 = meep.updateMask(mask);

//Define visualization parameters 
var vizParams2 = {
  min: 0,
  max: 1,
  palette: ['FF0000', '00FF00']
};

//Select just NDVI band and clip to rough island boundaries 
var ndvi = image1.select("NDVI")
var ndvi = ndvi.clip(geometry2)

//add the layer to the map
Map.addLayer(ndvi, vizParams2, 'ndvi'); 

//export the masked ndvi file here
Export.image.toDrive({
  image:ndvi,
  region:geometry, 
  description: 'jicaron-ndvi',
  folder: 'EarthEngineExport',
  fileNamePrefix: 'jicaron-ndvi',
  scale: 3
});